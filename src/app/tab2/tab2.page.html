<ion-content [fullscreen]="true">

  <page-loading-overlay [active]="isSavingExercise || isSavingWorkout" message="Please wait...">
  </page-loading-overlay>

  <div class="top-tabs">
    <button (click)="tab = 'exercise'" [class.active]="tab === 'exercise'">
      Add Exercise
    </button>
    <button (click)="tab = 'workout'" [class.active]="tab === 'workout'">
      Add Workout
    </button>
  </div>

  <!-- ADD EXERCISE -->
  <ng-container *ngIf="tab === 'exercise'">

    <h2>Add New Exercise</h2>

    <form [formGroup]="exerciseForm" class="neon-form">

      <ion-item>
        <ion-label position="stacked">Exercise Name</ion-label>
        <ion-input formControlName="name"></ion-input>
      </ion-item>

      <ion-item>
        <ion-label position="stacked">Description</ion-label>
        <ion-input formControlName="description"></ion-input>
      </ion-item>

      <div class="video-upload">
        <label for="videoInput">Choose Video</label>
        <input id="videoInput" type="file" accept="video/*" (change)="onVideoSelected($event)" />
      </div>

      <ion-button expand="block" color="tertiary" (click)="saveExercise()">
        <ion-spinner *ngIf="isSavingExercise" name="crescent"></ion-spinner>
        <span *ngIf="!isSavingExercise">Add Exercise</span>
      </ion-button>

    </form>
  </ng-container>


  <!-- ADD WORKOUT -->
  <ng-container *ngIf="tab === 'workout'">

    <h2>Create Workout</h2>

    <form [formGroup]="workoutForm" class="neon-form">

      <ion-item>
        <ion-label position="stacked">Title</ion-label>
        <ion-input formControlName="title"></ion-input>
      </ion-item>

      <ion-item>
        <ion-label position="stacked">Category</ion-label>
        <ion-input formControlName="subtitle"></ion-input>
      </ion-item>

      <ion-item>
        <ion-label position="stacked">Description</ion-label>
        <ion-input formControlName="content"></ion-input>
      </ion-item>
    </form>
    <h3>Exercises in Workout</h3>

    <ion-reorder-group [disabled]="false" (ionItemReorder)="handleReorder($event)">

      <ion-item lines="none" *ngFor="let ex of editableExercises; let i = index" class="workout-compact-row">

        <ion-reorder slot="start"></ion-reorder>

        <!-- SEKCIJA 1: NASLOV (1/3) -->
        <div class="workout-title-section">
          <div class="ex-title">
            {{ ex.name }}
            <span *ngIf="workoutItems[i].supersetExerciseId" class="superset-tag">
              → {{ getExerciseNameById(workoutItems[i].supersetExerciseId) }}
            </span>
          </div>
        </div>

        <!-- MOBILE SIMPLE VIEW -->
        <div class="mobile-row" (click)="openExerciseModal(i)">
          <div class="mobile-title">
            <span *ngIf="workoutItems[i].supersetExerciseId" class="mobile-superset">
              → {{ getExerciseNameById(workoutItems[i].supersetExerciseId) }}
            </span>
          </div>

        </div>
        <div class="workout-inputs-section">
          <div class="cfg small">
            <label><i class="fa-solid fa-repeat"></i> Sets</label>
            <ion-input type="number" [(ngModel)]="workoutItems[i].sets"></ion-input>
          </div>

          <div class="cfg small">
            <label><i class="fa-solid fa-repeat"></i>Reps</label>
            <ion-input type="number" [(ngModel)]="workoutItems[i].reps"></ion-input>
          </div>

          <div class="cfg small">
            <label><i class="fa-solid fa-stopwatch"></i> sets</label>
            <ion-input type="number" [(ngModel)]="workoutItems[i].restBetweenSets"></ion-input>
          </div>

          <div class="cfg small">
            <label><i class="fa-solid fa-stopwatch"></i> exercises</label>
            <ion-input type="number" [(ngModel)]="workoutItems[i].restAfterExercise"></ion-input>
          </div>

          <div class="superset-row">
            <div class="cfg superset">
              <label><i class="fa-solid fa-dumbbell"></i> Superset</label>
              <ion-select [(ngModel)]="workoutItems[i].supersetExerciseId" interface="popover">
                <ion-select-option value="">None</ion-select-option>
                <ion-select-option *ngFor="let opt of allExercises" [value]="opt.id">
                  {{ opt.name }}
                </ion-select-option>
              </ion-select>
            </div>
          </div>
        </div>
        <div class="workout-actions-section">
          <ion-button fill="clear" size="small" class="delete-btn" (click)="removeExercise(i)">
            <i class="fa-solid fa-delete-left"></i>
          </ion-button>
        </div>

      </ion-item>




    </ion-reorder-group>



    <h3>Add Exercise</h3>

    <ion-searchbar [value]="searchQuery" (ionInput)="onSearch($event)" placeholder="Search..." animated="true">
    </ion-searchbar>

    <ion-list>
      <ion-item *ngFor="let ex of filteredExercises">
        <ion-label>{{ ex.name }}</ion-label>
        <ion-button fill="outline" (click)="addExercise(ex)">Add</ion-button>
      </ion-item>
    </ion-list>

    <ion-button expand="block" color="success" (click)="saveNewWorkout()" [disabled]="isSavingWorkout">
      <ion-spinner *ngIf="isSavingWorkout" name="crescent"></ion-spinner>
      <span *ngIf="!isSavingWorkout">Create Workout</span>
    </ion-button>

  </ng-container>

</ion-content>