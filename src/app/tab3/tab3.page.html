<ion-content [fullscreen]="true" class="ion-padding content-container">

  <section class="section-box">
    <h2>My Exercises</h2>

    <ion-list lines="none">
      <ion-item *ngFor="let exercise of exercises" class="item-card" button detail="false"
        (click)="showExercisePreview(exercise)">
        <ion-label>
          <h3>{{ exercise.name }}</h3>
          <p>{{ exercise.description || 'Bez opisa' }}</p>
        </ion-label>

        <ion-button color="danger" fill="outline" slot="end"
          (click)="deleteExercise(exercise.id!); $event.stopPropagation();" class="delete-btn"
          [disabled]="isDeleting === exercise.id">
          <ion-spinner name="crescent" *ngIf="isDeleting === exercise.id"></ion-spinner>
          <i class="fa-solid fa-trash" *ngIf="isDeleting !== exercise.id"></i>
        </ion-button>
      </ion-item>

      <ion-item *ngIf="exercises.length === 0">
        <ion-label>Empty</ion-label>
      </ion-item>
    </ion-list>
  </section>

  <div class="separator"></div>

  <section class="section-box">
    <h2>My Trainings</h2>
    <ion-list>
      <ion-item *ngFor="let workout of workouts" class="item-card" button detail="false"
        (click)="showWorkoutDetails(workout)">
        <ion-label>
          <h3>{{ workout.title }}</h3>
          <p>{{ workout.subtitle || 'Bez kategorije' }}</p>
        </ion-label>

        <ion-button color="warning" fill="outline" slot="end"
          (click)="openEditWorkout(workout); $event.stopPropagation();" class="edit-btn">
          <i class="fa-solid fa-pen"></i>
        </ion-button>

        <ion-button color="danger" fill="outline" slot="end"
          (click)="deleteWorkout(workout.id!); $event.stopPropagation();" class="delete-btn"
          [disabled]="isDeleting === workout.id">
          <ion-spinner name="crescent" *ngIf="isDeleting === workout.id"></ion-spinner>
          <i class="fa-solid fa-trash" *ngIf="isDeleting !== workout.id"></i>
        </ion-button>
      </ion-item>

      <ion-item *ngIf="workouts.length === 0">
        <ion-label>Empty</ion-label>
      </ion-item>
    </ion-list>
  </section>

  <div class="separator"></div>

  <section class="section-box">
    <h2>Assigned by Trainer</h2>
    <ion-list>
      <ion-item *ngFor="let w of assignedWorkouts" class="item-card" button detail="false"
        (click)="showWorkoutDetails(w)">
        <ion-label>
          <h3>{{ w.title }}</h3>
          <p>{{ w.subtitle || 'Bez kategorije' }}</p>
        </ion-label>
      </ion-item>

      <ion-item *ngIf="assignedWorkouts.length === 0">
        <ion-label>Empty</ion-label>
      </ion-item>
    </ion-list>
  </section>

  <ion-button color="danger" expand="block" class="logout-btn" (click)="logout()">
    Logout
  </ion-button>

</ion-content>

<!-- ======================= EDIT WORKOUT MODAL ======================= -->
<ion-modal [isOpen]="showEditModal" (didDismiss)="showEditModal = false">
  <ng-template>

    <ion-header>
      <ion-toolbar>
        <ion-title>Edit Workout</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="showEditModal = false">Close</ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>

    <ion-content class="ion-padding">

      <ng-container *ngIf="editingWorkout">

        <ion-item>
          <ion-label position="stacked">Title</ion-label>
          <ion-input [(ngModel)]="editingWorkout.title"></ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Category</ion-label>
          <ion-input [(ngModel)]="editingWorkout.subtitle"></ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Description</ion-label>
          <ion-input [(ngModel)]="editingWorkout.content"></ion-input>
        </ion-item>

        <h3 class="modal-section-title">Exercises (drag to reorder)</h3>

        <ion-reorder-group [disabled]="false" (ionItemReorder)="handleReorder($event)">
          <ion-item *ngFor="let ex of editableExercises; let i = index">
            <ion-reorder slot="start"></ion-reorder>
            <ion-label>{{ ex.name }}</ion-label>
            <ion-button color="danger" fill="outline" (click)="removeExercise(i)">
              Remove
            </ion-button>
          </ion-item>
        </ion-reorder-group>

        <h3 class="modal-section-title">Add Exercise</h3>

        <ion-list>
          <ion-item *ngFor="let ex of exercises">
            <ion-label>{{ ex.name }}</ion-label>
            <ion-button fill="outline" (click)="addExercise(ex)">
              Add
            </ion-button>
          </ion-item>
        </ion-list>

        <ion-button expand="block" color="success" (click)="saveEdit()">
          Save Changes
        </ion-button>
      </ng-container>

    </ion-content>

  </ng-template>
</ion-modal>
<!-- =================================================================== -->
