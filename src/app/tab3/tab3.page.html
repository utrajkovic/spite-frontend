<ion-content #contentRef [fullscreen]="true" class="ion-padding content-container">

  <section class="section-box">
    <h2>My Exercises</h2>

    <ion-list lines="none">
      <ion-item *ngFor="let exercise of exercises" class="item-card" 
        (click)="openExercisePreview(exercise)">
        <ion-label>
          <h3>{{ exercise.name }}</h3>
        </ion-label>

        <ion-button color="danger" fill="outline" slot="end"
          (click)="deleteExercise(exercise.id!); $event.stopPropagation();" class="delete-btn"
          [disabled]="isDeleting === exercise.id">
          <ion-spinner name="crescent" *ngIf="isDeleting === exercise.id"></ion-spinner>
          <i class="fa-solid fa-trash" *ngIf="isDeleting !== exercise.id"></i>
        </ion-button>
      </ion-item>

      <ion-item *ngIf="exercises.length === 0">
        <ion-label>Empty</ion-label>
      </ion-item>
    </ion-list>
  </section>

  <div class="separator"></div>

  <section class="section-box">
    <h2>My Trainings</h2>
    <ion-list>
      <ion-item *ngFor="let workout of workouts" class="item-card" 
        (click)="showWorkoutDetails(workout)">
        <ion-label>
          <h3>{{ workout.title }}</h3>
          <p>{{ workout.subtitle || 'Bez kategorije' }}</p>
        </ion-label>

        <ion-button color="warning" fill="outline" slot="end"
          (click)="openEditWorkout(workout); $event.stopPropagation();" class="edit-btn">
          <i class="fa-solid fa-pen"></i>
        </ion-button>

        <ion-button color="danger" fill="outline" slot="end"
          (click)="deleteWorkout(workout.id!); $event.stopPropagation();" class="delete-btn"
          [disabled]="isDeleting === workout.id">
          <ion-spinner name="crescent" *ngIf="isDeleting === workout.id"></ion-spinner>
          <i class="fa-solid fa-trash" *ngIf="isDeleting !== workout.id"></i>
        </ion-button>
      </ion-item>

      <ion-item *ngIf="workouts.length === 0">
        <ion-label>Empty</ion-label>
      </ion-item>
    </ion-list>
  </section>

  <div class="separator"></div>

  <section class="section-box">
    <h2>Assigned by Trainer</h2>
    <ion-list>
      <ion-item *ngFor="let w of assignedWorkouts" class="item-card" button detail="false"
        (click)="showWorkoutDetails(w)">
        <ion-label>
          <h3>{{ w.title }}</h3>
          <p>{{ w.subtitle || 'Bez kategorije' }}</p>
        </ion-label>
      </ion-item>

      <ion-item *ngIf="assignedWorkouts.length === 0">
        <ion-label>Empty</ion-label>
      </ion-item>
    </ion-list>
  </section>

  <ion-button color="danger" expand="block" class="logout-btn" (click)="logout()">
    Logout
  </ion-button>

</ion-content>

<ion-modal #exerciseModal class="exercise-modal" [presentingElement]="null">
  <ng-template>
    <div class="alert-box">

      <h2 class="title">{{ previewExercise?.name }}</h2>

      <video *ngIf="previewExercise?.videoUrl" [src]="previewExercise?.videoUrl" autoplay loop [muted]="true"
        playsinline class="preview-video">
      </video>

      <p class="description">
        {{ previewExercise?.description || 'No description' }}
      </p>

      <ion-button color="primary" expand="block" (click)="closeExerciseModal()">
        Close
      </ion-button>

    </div>
  </ng-template>
</ion-modal>
<ion-modal #workoutModal class="workout-modal" [initialBreakpoint]="0.5" [breakpoints]="[0, 0.5]">
  <ng-template>
    <div class="alert-box">

      <h2 class="title">{{ previewWorkout?.title }}</h2>

      <p class="description">
        <strong>Category:</strong> {{ previewWorkout?.subtitle || '—' }}
      </p>

      <p class="description">
        <strong>Description:</strong> {{ previewWorkout?.content || '—' }}
      </p>

      <div class="exercise-list" *ngIf="previewWorkoutExercises?.length">
        <h3 class="exercise-title">Exercises</h3>
        <ul>
          <li *ngFor="let ex of previewWorkoutExercises">
            {{ ex }}
          </li>
        </ul>
      </div>

      <ion-button color="primary" expand="block" (click)="closeWorkoutModal()">
        Close
      </ion-button>

    </div>
  </ng-template>
</ion-modal>